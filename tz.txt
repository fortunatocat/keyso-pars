Цель: написать CLI-утилиту на Python, которая по списку доменов из CSV получает из Keys.so органические метрики доменов и сохраняет в CSV с возможностью безопасного рестарта.

Вход:

CSV (UTF‑8) с колонкой Домен (пример: Vremennaia-List2.csv).
​

Параметры CLI:

--input путь к входному CSV

--output путь к выходному CSV

--base регион (default msk)

--limit сколько доменов обработать за запуск (0=все)

--domain-col имя колонки домена (default Домен)

--timeout таймаут HTTP

API токен из env KEYSSO_TOKEN (не хранить в коде/аргументах).

Получаемые метрики (колонки output):

domain, base

it1, it3, it5, it10, it50, vis

traf (органический трафик — если поле есть в ответе; иначе пусто)

служебные: http_status, error, request_url

Источник данных API:

Основной endpoint: GET https://api.keys.so/report/simple/domain_dashboard?base=msk&domain=example.com

Авторизация: “каждый запрос должен быть подписан токеном” — реализовать передачу токена через заголовок (если точный header неизвестен, сделать поддержку двух вариантов: Authorization: Bearer <token> и X-API-KEY: <token>, чтобы быстро проверить).

Ограничения и надёжность:

Rate limit: максимум 10 запросов за 10 секунд (реализовать скользящее окно).

После каждого домена делать append в выходной CSV и flush.

При старте читать output CSV и собирать set уже записанных доменов; если домен уже есть — пропускать (контроль дублей).

Обрабатывать ошибки сети/JSON: не падать, писать в error, продолжать.

Опционально (если успеешь):

--sleep-mode burst|smooth: burst = 10 запросов сразу + sleep(10), smooth = 1 запрос/сек (оба режима укладываются в лимит).